# Tigris API Reverse Engineering Memo


## Login

Normal login. Only used to get `siteId`.


### Request

| Parameter Name   | Explanation                               |
|------------------|-------------------------------------------|
| `siteId`         | Unused                                    |
| `timeZoneId`     | Timezone. Seemingly fixed to `Asia/Seoul` |
| `recaptchaToken` | Unused                                    |
| `loginId`        | Email                                     |
| `passwd`         | Password                                  |

```json
{
  "method": "POST",
  "url": "https://www.tigrison.com/login",
  "body": {
    "siteId": "",
    "timeZoneId": "Asia/Seoul",
    "recaptchaToken": "",
    "loginId": "{EMAIL}",
    "passwd": "{PASSWORD}"
  }
}
```

### Success

```json
{
  "code": 0,
  "message": "성공",
  "data": {
    "siteId": "SITE_ID_NEVER_LEAK_OR_UR_FCKED",
    "sessionId": "SESSION_ID",
    "passwdChangeType": "NONE",
    "emptyInfoYn": "Y",
    "redirect5240Page": "Y",
    "siteWebChatVersion": null
  }
}
```

### Fail

```json
{
  "code": 100,
  "message": "ID 또는 비밀번호가 잘못 되었습니다.",
  "data": null
}
```

---

## Index

Called after login to fetch SSO login URL with hardcoded password. (but won't write here)

This returned URL is *EXTREMELY DANGEROUS* - refer to [Cloud SSO Login](#cloud-sso-login)


### Request

| Cookie Name   | Explanation                     |
|---------------|---------------------------------|
| `_tigris_sid` | Session ID from [login](#login) |

```json
{
  "method": "GET",
  "url": "https://www.tigrison.com/hr/index",
  "cookies": {
    "_tigris_sid": "{SESSION_ID}"
  }
}
```

### Success

```json
{
  "code": 0,
  "message": "성공",
  "data": "https://api.tigris5240.com/cloudSsologinUser.do?siteId={SITE_ID}&userMailId={EMAIL}&loginUserId={EMAIL}&loginPassword={HARDCODED_PASSWORD}&multiLangCd=ko"
}
```

### Fail

TBD


## Cloud SSO Login

> ### WARNING - Extreme security flaw
> 
> _NEVER_ leak `siteId` or this can be used to access all functionality **_AS ANYONE, ANYWHERE WITHOUT PASSWORD_**
> with just email alone. ***DO. NOT. LEAK.***  
> <sub>(What an actual fuck??? People pay for this???)</sub>

This is used to open web interface using URL from previous [`Index`](#index) api response. 

This is also responsible for setting SSO `JSESSIONID` cookie (not one generated by browser)
used for subsequent tigris API calls.

### Request

| Parameter Name  | Explanation                       |
|-----------------|-----------------------------------|
| `siteId`        | UID for each organization         |
| `userMailId`    | Email                             |
| `loginUserId`   | Email                             |
| `loginPassword` | Hardcoded password                |
| `multiLangCd`   | Language. Seemingly fixed to `ko` |

```json
{
  "method": "POST",
  "url": "https://api.tigris5240.com/cloudSsologinUser.do",
  "params": {
    "siteId": "{SITE_ID}",
    "userMailId": "{EMAIL}",
    "loginUserId": "{EMAIL}",
    "loginPassword": "{HARDCODED_PASSWORD}",
    "multiLangCd": "ko"
  }
}
```


### Success

Redirects to `https://api.tigris5240.com/Main.do;jsessionid={JSESSIONID}?result=` and set `JSESSIONID` cookie.

```
Set-Cookie: JSESSIONID={JSESSIONID}; Path=/; HttpOnly
Location: /Main.do;jsessionid={JSESSIONID}?result=
```


### Fail

Redirects to `https://api.tigris5240.com/NoMatchingData.do;...`


---

## Check Login Session

Seems like this checks if user is logged in. Called before calendar data fetch.

### Request

```json
{
  "method": "POST",
  "url": "https://api.tigris5240.com/chkLoginSession.do",
  "cookies": {
    "JSESSIONID": "{JSESSIONID}"
  }
}
```

### Success

```json
{
  "loginInfo": "Login!"
}
```

### Fail

TBD

---

## Fetch calendar data

Returns a list of events. Unlike other requests, Referer header is absolutely required.

### Request

- `searchSYmd`: start time in ISO 8601 format (`YYYY-MM-DDTHH:MM:SS+09:00`)
- `searchEYmd`: end time in ISO 8601 format (`YYYY-MM-DDTHH:MM:SS+09:00`)

If both query's format starts at 0 hour 0 min (i.e. 2025-01-12T00:00:00+09:00)
this will include global events) events overlapping this time range.

If not, this will only give personal events matching logged-in user's team.

This call, when done by official site fetches all events in the time range regardless of logged-in user's team.

How to enable this behavior is not yet known, no header or cookies seems to explain this.


```json
{
  "method": "POST",
  "url": "https://api.tigris5240.com/TAADclzVcatnCldrMgr.do",
  "headers": {
    "Referer": "https://api.tigris5240.com/TAADclzVcatnCldrMgr.do?cmd=viewTAADclzVcatnCldrMgr"
  },
  "cookies": {
    "JSESSIONID": "{SESSION_ID}",
    "colShowYn": "N",
    "kiwiboxSaveChk": "true",
    "menuShow": "Y"
  },
  "params": {
    "cmd": "getTAADclzVcatnCldrMgr"
  },
  "body": {
    "searchSYmd": "{START_TIME}",
    "searchEYmd": "{END_TIME}",
    "cmmSearchOrgCd": "",
    "orgSearchType": "N",
    "searchPosCd": "",
    "searchResCd": ""
  }
}
```

### Success

Returns Json consisting a list of events, starting by global organization-wide events i.e. holidays.

```json
{
    "Message": "",
    "DATA": [
        {
            "kind": null,
            "title": null,
            "leavNm": null,
            "leavCd": null,
            "personInfo": null,
            "orgCd": null,
            "orgNm": null,
            "posCd": null,
            "posNm": null,
            "resCd": null,
            "resNm": null,
            "wktypeCd": null,
            "wktypeNm": null,
            "staYmd": null,
            "endYmd": null,
            "endYmdAdd": null,
            "agentName": null,
            "allDay": null,
            "staHm": null,
            "endHm": null,
            "reqStatusCd": null,
            "reason": null,
            "note": null
        },
        ...
    ]
}
```


| Key Name      | Data Type         | Explanation (Speculation)                                                                                                  |
|---------------|-------------------|----------------------------------------------------------------------------------------------------------------------------|
| `kind`        | String            | The type of event. `vacation` usually                                                                                      |
| `title`       | String            | Title of the event. Has (△) sign if it's not approved yet                                                                  |
| `leavNm`      | String            | Name of the vacation in Korean                                                                                             |
| `leavCd`      | Integer           | Unique identifier for the vacation type                                                                                    |
| `personInfo`  | String            | Information about the person responsible in `{orgNm}{resNm}{posNm}{wktypeNm}` format. set to `///` if it's global vacation |
| `orgCd`       | String (nullable) | Organizational code (usually null for global events)                                                                       |
| `orgNm`       | String (nullable) | Organizational name                                                                                                        |
| `posCd`       | String (nullable) | Position code (usually null for global events)                                                                             |
| `posNm`       | String (nullable) | Position name                                                                                                              |
| `resCd`       | String (nullable) | Resignation code (usually null for global events)                                                                          |
| `resNm`       | String (nullable) | Resignation name                                                                                                           |
| `wktypeCd`    | String (nullable) | Work type code                                                                                                             |
| `wktypeNm`    | String (nullable) | Work type name                                                                                                             |
| `staYmd`      | String            | Start date of the vacation in YYYY-MM-DD format, else YYYYMMDD format.                                                     |
| `endYmd`      | String            | End date of the vacation in YYYY-MM-DD format if personal, else YYYYMMDD format.                                           |
| `endYmdAdd`   | String (nullable) | Immediate day after `endYmd` in YYYY-MM-DD format                                                                          |
| `agentName`   | String (nullable) | Agent name (usually null for global events)                                                                                |
| `allDay`      | Boolean           | Whether the vacation is a full-day or half-day                                                                             |
| `staHm`       | String (nullable) | Start hour of the vacation in THHMMSS format (usually null for global events)                                              |
| `endHm`       | String (nullable) | End hour of the vacation in THHMMSS format (usually null for global events)                                                |
| `reqStatusCd` | String (nullable) | Status code indicating whether the request was approved or rejected                                                        |
| `reason`      | String (nullable) | Reason for taking the vacation (null for global events)                                                                    |
| `note`        | String (nullable) | Additional information written by requesters (null for global events)                                                      |


### Fail (invalid header)

Redirected to `http://api.tigris5240.com/Error.do?code=905`


### Fail (invalid cookie)

Return empty data

```json
{
  "Message": "",
  "DATA": []
}
```


---

## Fetch Organization search count (??)

### Request

| Parameter Name | Explanation               |
|----------------|---------------------------|
| `orgNm`        | Organization name or code |

```json
{
  "method": "POST",
  "url": "https://api.tigris5240.com/Popup.do",
  "params": {
    "cmd": "getOrgBasicCnt"
  },
  "body": {
      "orgNm": "{ORGANIZATION_NAME}"
  }
}
```

### Success

```json
{
  "Message": "",
  "DATA": {
    "cnt": 1
  }
}
```


## Fetch Organization detail


### Request

| Parameter Name | Explanation               |
|----------------|---------------------------|
| `orgCd`        | Organization name or code |

```json
{
  "method": "POST",
  "url": "https://api.tigris5240.com/Popup.do",
  "params": {
    "cmd": "getOrgBasicDtl"
  },
  "body": {
      "orgCd": "{ORGANIZATION_NAME}"
  }
}
```


### Success

```json
{
  "map": {
    "orgCd": "{ORGANIZATION_CODE}",
    "orgNm": "{ORGANIZATION_NAME}",
    "orgFnm": null,
    "orgEnm": null,
    "inoutTypeCd": "{}",
    "orgTypeCd": null,
    "telNo": null,
    "staYmd": "YYYYMMDD",
    "endYmd": "YYYYMMDD",
    "coTelNo": null,
    "delYn": null
  }
}
```
